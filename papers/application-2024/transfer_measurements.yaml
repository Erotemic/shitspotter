# This file is manual record of network speed measurments to study the
# differences betweend distribution methods.
#
# SeeAlso:
#     ~/code/shitspotter/papers/application-2024/scripts/gather_measurements.py
---

machine_info:
  - name: toothbrush
    cpu_max_mhz: 5300.0000
    cpu_min_mhz: 800.0000
  - name: jojo
    cpu_max_mhz: 1800.0000
    cpu_min_mhz: 600.0000
  - name: ooo
    cpu_max_mhz: 3800.0000
    cpu_min_mhz: 1600.0000
  - name: namek
    cpu_max_mhz: 3000.0000
    cpu_min_mhz: 1200.0000

network_measurements:
  - recording_time: 2024-08-06T190810-5
    action: transfer
    method: bittorrent
    src_machine: jojo
    dst_machine: namek
    multiple_seeders: unlikely
    duration: "215176 seconds"
    history.date_added: "Sun Aug  4 19:36:53 2024"
    history.date_started: "Sun Aug  4 19:36:53 2024"
    history.latest_activity: "Mon Aug  5 02:09:41 2024"
    history.downloading_time: "2 days, 11 hours (215176 seconds)"
    transfer.percent_done: "99.9%"
    name: shitspotter_dvc
    hash: 040b6645b16518de50278f5d4b2584b3a18438d5
    magnet: "magnet:?xt=urn:btih:040b6645b16518de50278f5d4b2584b3a18438d5&dn=shitspotter%5Fdvc&tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A80"
    origins.date_created: Sat Jul 27 22:02:08 2024
    origins.public_torrent: true
    origins.comment: first shitspotter torrent
    origins.creator: Transmission/3.00 (bb6b5a062e)
    origins.piece_count: 20454
    origins.piece_size: 2.00 MiB

  - recording_time: 2024-08-06T192625-5
    action: transfer
    method: rsync
    src_machine: toothbrush
    dst_machine: toothbrush
    multiple_seeders: null
    time.real: "0m41.013s"
    time.user: "0m11.660s"
    time.sys: "0m41.786s"
    duration: "41.013s"
    rsync.output: "sent 45,016,353,426 bytes  received 174,242 bytes  1,084,735,606.46 bytes/sec"
    command: "time rsync -avprPR --chmod=Du=rwx,Dg=rwx,Do=rwx,Fu=rw,Fg=rw,Fo=rw $HOME/data/dvc-repos/./shitspotter_dvc /var/lib/transmission-daemon/downloads/"

  - recording_time: 2024-08-06T193000-5
    action: create-torrent
    machine: toothbrush
    command: "time transmission-create --outfile /var/lib/transmission-daemon/downloads/shitspotter_dvc_v3.torrent --tracker udp://open.tracker.cl:1337/announce --comment 'shitspotter torrent v3' /var/lib/transmission-daemon/downloads/shitspotter_dvc"
    duration: "0m45.057s"
    time.real: "0m45.057s"
    time.user: "0m24.288s"
    time.sys: "0m12.644s"
    data_size: "42G"

  - recording_time: 2024-08-06T193400-5
    action: create-torrent
    machine: jojo
    command: "time transmission-create --outfile /var/lib/transmission-daemon/downloads/shitspotter_dvc_v3.torrent --tracker udp://open.tracker.cl:1337/announce --comment 'shitspotter torrent v3' /var/lib/transmission-daemon/downloads/shitspotter_dvc"
    duration: "20m4.330s"
    time.real: "20m4.330s"
    time.user: "5m52.390s"
    time.sys: "1m41.123s"
    data_size: "42G"

  - recording_time: 2024-08-06T211010-5
    action: add_torrent_existing_data
    method: bittorrent
    machine: jojo
    command: "transmission-remote --auth transmission:transmission --add /var/lib/transmission-daemon/downloads/shitspotter_dvc_v3.torrent --download-dir /var/lib/transmission-daemon/downloads"
    scratch: |-
      import kwutil
      d = kwutil.datetime.coerce
      t = kwutil.timedelta.coerce
      print((d('2024-08-06T21:28:57') - t('109 seconds')) - d('2024-08-06T21:10:10'))
    duration: 16.966 minutes
    notes: "Started verifying, which is taking time. 27% done 5.3 minutes ((21:28:57 - 109 seconds) - 21:10:10)"
    torrent.magnet: "magnet:?xt=urn:btih:ee8d2c87a39ea9bfe48bef7eb4ca12eb68852c49&dn=shitspotter%5Fdvc&tr=udp%3A%2F%2Fopen.tracker.cl%3A1337%2Fannounce"
    torrent.hash: "ee8d2c87a39ea9bfe48bef7eb4ca12eb68852c49"

  - recording_time: 2024-08-06T203326-5
    action: add_torrent_for_download
    method: bittorrent
    machine: namek
    command: "transmission-remote --auth transmission:transmission --add 'magnet:?xt=urn:btih:ee8d2c87a39ea9bfe48bef7eb4ca12eb68852c49&dn=shitspotter%5Fdvc&tr=udp%3A%2F%2Fopen.tracker.cl%3A1337%2Fannounce' --download-dir /var/lib/transmission-daemon/downloads"

  - recording_time: 2024-08-07T085722-5
    action: transfer
    method: bittorrent
    src_machine: jojo
    dst_machine: namek
    multiple_seeders: unlikely
    history.date_added: Tue Aug  6 21:33:35 2024
    history.date_finished: Wed Aug  7 03:20:56 2024
    history.date_started: Tue Aug  6 21:56:16 2024
    history.latest_activity: Wed Aug  7 03:20:56 2024
    history.downloading_time: 6 hours (24725 seconds)
    duration: 24725 seconds
    history.seeding_time: 8 hours (29334 seconds)

    transfer.percent_done: "100%"
    name: shitspotter_dvc
    hash: ee8d2c87a39ea9bfe48bef7eb4ca12eb68852c49
    magnet: "magnet:?xt=urn:btih:ee8d2c87a39ea9bfe48bef7eb4ca12eb68852c49&dn=shitspotter%5Fdvc&tr=udp%3A%2F%2Fopen.tracker.cl%3A1337%2Fannounce"
    origins.public_torrent: Yes
    origins.piece_count: 21434
    origins.piece_size: 2.00 MiB

  - recording_time: 2024-08-08T21:10:00-5
    action: transfer
    method: ipfs
    src_machine: jojo
    dst_machine: namek
    cid: bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y
    multiple_seeders: likely-partial
    command: |-
      date
      time ipfs pin add --name shitspotter-2024-07-03 --progress bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y
      date
    notes: |-
      Namek responded quickly and got to 8050 but then got stuck. 2 hours in I
      realized jojo's ipfs server was off. Hopefully it will pick up jojo as a
      peer soon. I grew impatient with this run, killed it, and restarted.

      startup took a very long time, and it hung for hours until I manually
      forced namek to connect to jojo via running this on namek
      ipfs swarm connect /p2p/12D3KooWCFcfiBevjQD42aRAELMUZXAGScRiN2NcAthokF4dMnVU
      This was at 2024-08-08T23:38:00-5
      I should measure the time from announce to the time an unconnected peer
      figures out the correct peer to connect to via the network
    time.real: "279m3.068s"
    time.user: "0m14.143s"
    time.sys: "0m2.202s"
    duration: 279m3.068s
    time.start_date: "Thu 08 Aug 2024 09:10:56 PM EDT"
    time.end_date: "Fri 09 Aug 2024 01:49:59 AM EDT"

  - recording_time: 2024-08-09T10:49:00-5
    action: transfer
    method: ipfs
    src_machine: jojo
    dst_machine: namek
    multiple_seeders: likely-partial
    command: |-
      date && time ipfs pin add --name shitspotter-2024-07-03 --progress bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y && date
    notes: |-
      second run of pin that should be primed to go.
    time.real:    107m50.797s
    time.user:    0m3.163s
    time.sys:     0m1.343s
    duration: 107m50.797s
    time.start_date: Fri 09 Aug 2024 10:49:42 AM EDT
    time.end_date:   Fri 09 Aug 2024 12:37:33 PM EDT

  - recording_time: 2024-08-09T13:03:00-5
    action: transfer
    method: rsync
    src_machine: toothbrush
    dst_machine: namek
    multiple_seeders: na
    command: |-
      date && time rsync -avprPR $HOME/data/dvc-repos/./shitspotter_dvc namek:data/dvc-repos && date
    duration: 365m52.482s
    time.real:    365m52.482s
    time.user:    24m34.053s
    time.sys:     1m35.558s
    time.start_date: Fri Aug  9 01:06:10 PM EDT 2024  
    time.end_date: Fri Aug  9 07:12:02 PM EDT 2024

  - recording_time: 2024-08-09T200812-5
    action: upload
    method: girder-upload-GUI
    src_machine: toothbrush
    dst_machine: data.kitware.com
    duration: nan
    notes: |
      Uploaded shitspotter-snapshot-2024-08-09T185233-5, I started this log a
      few minutes after I started the actual upload. Dont think I will get
      an accurate measurement here. 

      I dont know if data.kitware.com handles de-duplication or if that
      is even something that could be used with the zip strategy.

      At 2024-08-09T201009-5 I am 700.2 MB / 41.36 GB uploaded
      At 2024-08-09T201141-5 I am 900.8 MB / 41.36 GB uploaded
      At 2024-08-09T201226-5 I am 1001.1 MB / 41.36 GB uploaded

      import kwutil
      from kwutil.util_units import unit_registry
      ureg = unit_registry()
      total = 41.36 * ureg.gigabyte
      rows = [
        {'time': kwutil.datetime.coerce('2024-08-09T201009-5'), 'amount': 700.2 * ureg.megabyte},
        {'time': kwutil.datetime.coerce('2024-08-09T201141-5'), 'amount': 900.8 * ureg.megabyte},
        {'time': kwutil.datetime.coerce('2024-08-09T201226-5'), 'amount': 1001.1 * ureg.megabyte},
        {'time': kwutil.datetime.coerce('2024-08-09T202000-5'), 'amount': 1.9 * ureg.gigabyte},
      ]
      max_time = kwutil.datetime.coerce('2024-08-10T08:57:44.853000+00:00')
      (max_time - rows[0]['time']).total_seconds() / 60 / 60
      rates = []
      for r1, r2 in ub.iter_window(rows, 2):
        time_delta = (r2['time'] - r1['time']).total_seconds() * ureg.seconds
        data_delta = r2['amount'] - r1['amount']
        rates.append(data_delta / time_delta)
      avg_rate = sum(rates) / len(rates)
      est_seconds = (total / avg_rate).to(ureg.second)
      est_hours = est_seconds.to(ureg.hour)
      print(est_hours)
      upload failed due to storage quota issues

  - recording_time: 2024-08-09T220343-5
    action: upload
    method: girder-upload-GUI
    src_machine: toothbrush
    dst_machine: data.kitware.com
    duration: 5.88 hours
    notes: |-
      # For the first 34 non-assets
      #{'time': kwutil.datetime.coerce('2024-08-09T220451-5'), 'amount': 0.0 * ureg.megabyte},
      #{'time': kwutil.datetime.coerce('2024-08-09T220509-5'), 'amount': 30.4 * ureg.megabyte},
      import kwutil
      from kwutil.util_units import unit_registry
      ureg = unit_registry()
      total = 41.36 * ureg.gigabyte
      rows = [
        # For the assets
        {'time': kwutil.datetime.coerce('2024-08-09T220558-5'), 'amount': 0. * ureg.megabyte},
        {'time': kwutil.datetime.coerce('2024-08-09T220741-5'), 'amount': 230.7 * ureg.megabyte},
        {'time': kwutil.datetime.coerce('2024-08-09T223926-5'), 'amount': 4. * ureg.gigabyte},
        {'time': kwutil.datetime.coerce('2024-08-09T224733-5'), 'amount': 5. * ureg.gigabyte},
        {'time': kwutil.datetime.coerce('2024-08-10T005451-5'), 'amount': 19.68 * ureg.gigabyte},
      ]
      rates = []
      for r1, r2 in ub.iter_window(rows, 2):
        time_delta = (r2['time'] - r1['time']).total_seconds() * ureg.seconds
        data_delta = r2['amount'] - r1['amount']
        rates.append(data_delta / time_delta)
      avg_rate = sum(rates) / len(rates)
      est_seconds = (total / avg_rate).to(ureg.second)
      est_hours = est_seconds.to(ureg.hour)
      print(est_hours)

      # girder-client --api-url https://data.kitware.com/api/v1 list 66b6d906f87a980650f41fd0 --json > girder-data.json

      import kwutil
      data = kwutil.Json.coerce('girder-data.json')
      data['this_record']
      data['parent_record']

      start_time = rows[0]['time']

      from kwutil.util_units import unit_registry
      ureg = unit_registry()
      update_dates = [kwutil.datetime.coerce(item['updated']) for item in data['item_children']]
      max_update = max(update_dates)
      min_update = min(update_dates)
      total_time = ((max_update - start_time).total_seconds() * ureg.seconds).to(ureg.hours)

  - recording_time: 2024-08-12T092252-5
    action: transfer
    method: ipfs
    src_machine: jojo
    dst_machine: namek
    multiple_seeders: unlikely
    command: |
      transmission-remote --auth transmission:transmission --add 'magnet:?xt=urn:btih:ee8d2c87a39ea9bfe48bef7eb4ca12eb68852c49&dn=shitspotter%5Fdvc&tr=udp%3A%2F%2Fopen.tracker.cl%3A1337%2Fannounce' --download-dir /var/lib/transmission-daemon/downloads
      # A little while later (11:20AM), after no progress
      transmission-remote --auth transmission:transmission --t5 --start
      transmission-remote --auth transmission:transmission --list
      transmission-remote --auth transmission:transmission -t1 --info
    duration: 51816 seconds
    history.date_added:       Mon Aug 12 10:22:51 2024
    history.date_finished:    Mon Aug 12 22:38:57 2024
    history.date_started:     Mon Aug 12 20:04:04 2024
    history.latest_activity:  Mon Aug 12 22:38:57 2024
    history.downloading_time: 14 hours (51816 seconds)
    history.seeding_time:     1 day, 21 hours (163556 seconds)
        
  - recording_time: 2024-08-08T21:10:00-5
    action: transfer
    method: ipfs
    src_machine: jojo
    dst_machine: namek
    cid: bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y
    multiple_seeders: likely-partial
    command: |-
      # First remove all pins on namek
      systemctl start ipfs.service
      ipfs pin ls --type="recursive" --names
      ipfs pin ls --type recursive | cut -d ' ' -f1 | xargs -n1 ipfs pin rm
      ipfs repo gc
      # Then start the timed download
      date && time ipfs pin add --name shitspotter-2024-07-03 --progress bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y && date
      # Force it to connect to jojo (on 2024-08-15T115624-5)
      ipfs swarm connect /p2p/12D3KooWCFcfiBevjQD42aRAELMUZXAGScRiN2NcAthokF4dMnVU
    notes: |-
      After nearly a day of waiting, it still did not find my node
    time.real:    1477m19.885s
    time.user:    0m18.891s
    time.sys:     0m25.336s
    time.start_date: Wed 14 Aug 2024 06:00:14 PM EDT
    time.end_date: Thu 15 Aug 2024 06:37:34 PM EDT

  - recording_time: 2024-08-15T218949-5
    action: update
    method: ipfs
    src_machine: ipfs
    dst_machine: ipfs
    multiple_seeders: likely
    time.start_date: Fri Aug 16 03:18:49 UTC 2024
    command: |-
      systemctl start ipfs.service
      # Then start the timed download
      date && time ipfs pin add --name shitspotter-2024-07-03 --progress bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y && date
    duration: 9m31.502sreal
    time.real:    9m31.502s
    time.user:    0m0.152s
    time.sys:    0m0.035s
    time.end_date: Fri Aug 16 03:28:20 UTC 2024
        
  - recording_time: 2024-08-15T223738-5
    action: transfer
    method: ipfs
    src_machine: ipfs
    dst_machine: calculex
    multiple_seeders: likely
    time.start_date: Thu Aug 15 11:37:31 PM EDT 2024
    command: |-
      systemctl start ipfs.service
      ipfs config --json Identity.PeerID
      ipfs swarm connect /p2p/12D3KooWPyQK2JEXnqK1QxiV9Y7bG3UsUQC5iQvDxn8bV1uqvsbi
      # Then start the timed download
      date && time ipfs pin add --name shitspotter-2024-07-03 --progress bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y && date
      # on ipfs
      ipfs swarm connect /p2p/12D3KooWS612EDC67bmFD4pyoAUmW93G1QW9GYCkqDg71bdBRgri
    time.real:    9m31.502s
    time.user:    0m0.152s
    time.sys:    0m0.035s
    time.end_date: Fri Aug 16 03:28:20 UTC 2024
    notes: man... even with peer connect it didnt grab anything.
        
  - recording_time: Fri Aug 16 20:22:50 EDT 2024
    action: transfer
    method: ipfs
    src_machine: jojo
    dst_machine: calculex
    multiple_seeders: likely
    command: |-
      systemctl start ipfs.service
      systemctl status ipfs.service
      ipfs config --json Identity.PeerID
      ipfs swarm connect /p2p/12D3KooWS612EDC67bmFD4pyoAUmW93G1QW9GYCkqDg71bdBRgri
      ipfs swarm connect /p2p/12D3KooWCFcfiBevjQD42aRAELMUZXAGScRiN2NcAthokF4dMnVU
      ipfs swarm connect /p2p/12D3KooWPyQK2JEXnqK1QxiV9Y7bG3UsUQC5iQvDxn8bV1uqvsbi
      # Then start the timed download
      date && time ipfs pin add --name shitspotter-2024-07-03 --progress bafybeiedwp2zvmdyb2c2axrcl455xfbv2mgdbhgkc3dile4dftiimwth2y && date
      # on ipfs
    time.start_date: Fri Aug 16 08:22:59 PM EDT 2024
    time.real:    9m31.502s
    time.user:    0m0.152s
    time.sys:    0m0.035s
    time.end_date: Fri Aug 16 03:28:20 UTC 2024
    notes: man... even with peer connect it didnt grab anything.
        
